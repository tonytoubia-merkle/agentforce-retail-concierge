<?xml version="1.0" encoding="UTF-8"?>
<GenAiPromptTemplate xmlns="http://soap.sforce.com/2006/04/metadata">
    <masterLabel>Conversational Event Capture</masterLabel>
    <description>Analyzes conversation for meaningful events and profile intelligence. Used by both agents as an invocable action.</description>
    <type>einstein_gpt__flex</type>
    <templateVersions>
        <content>
You are analyzing a conversation message for meaningful life events, purchase intent, concerns, preferences, or milestones that should be captured for customer personalization.

CONVERSATION MESSAGE TO ANALYZE:
{!$Input:ConversationMessage}

CUSTOMER NAME:
{!$Input:CustomerName}

AGENT TYPE:
{!$Input:AgentType}

---

CAPTURE RULES — ONLY capture meaningful LIFE EVENTS. These are time-bound occurrences in the customer&apos;s life that create personalization opportunities:

- Trips and travel: &quot;I am going to Dubai&quot;, &quot;flying to Paris next week&quot;, &quot;planning a vacation&quot;
- Weddings: &quot;my daughter is getting married&quot;, &quot;I have a wedding coming up&quot;
- Maternity: &quot;I am expecting&quot;, &quot;pregnant&quot;, &quot;having a baby&quot;
- Birthdays: &quot;my birthday is next month&quot;, &quot;turning 30&quot;
- Anniversaries: &quot;our anniversary is coming up&quot;
- Relocations: &quot;moving to a new city&quot;, &quot;just relocated&quot;
- Graduations: &quot;graduating in June&quot;, &quot;my son is graduating&quot;
- Career changes: &quot;starting a new job&quot;, &quot;got promoted&quot;

Do NOT capture (these are handled by profile enrichment separately):
- Preferences (&quot;I only use fragrance-free&quot;) — captured via Profile Enrichment
- Concerns (&quot;my skin is breaking out&quot;) — captured via Profile Enrichment
- Purchase intent (&quot;I want to buy&quot;) — captured via Profile Enrichment
- Routine changes (&quot;I switched to clean beauty&quot;) — captured via Profile Enrichment
- Generic politeness, restating agent info, or vague browsing

EVENT TYPE VALUES — use the MOST SPECIFIC type that matches:
- &quot;Travel&quot; — trips, vacations, flights, travel plans
- &quot;Wedding&quot; — weddings (own or someone else&apos;s)
- &quot;Maternity&quot; — pregnancy, expecting, new baby
- &quot;Birthday&quot; — birthdays, birthday celebrations
- &quot;Anniversary&quot; — anniversaries, relationship milestones
- &quot;Relocation&quot; — moving, new home, relocating to new city/climate
- &quot;Graduation&quot; — graduations, commencements
- &quot;Career&quot; — new jobs, promotions, career changes
- &quot;Other&quot; — any other life event that does not fit the above categories

EVENT DESCRIPTION:
Write a concise summary of what was said, NOT a generic label.
Good: &quot;Planning trip to Mumbai in two weeks, concerned about humidity and skin oiliness&quot;
Bad: &quot;Travel event&quot;

METADATA JSON — ALWAYS include structured timing data:
{&quot;relativeTimeExpression&quot;: &quot;exact words about timing&quot;, &quot;eventDate&quot;: &quot;YYYY-MM-DD if known&quot;, &quot;eventEndDate&quot;: &quot;YYYY-MM-DD if known&quot;, &quot;destination&quot;: &quot;location if applicable&quot;, &quot;forWhom&quot;: &quot;self or someone else&quot;}

TIMING — when capturing life events, ALWAYS extract:
- &quot;relativeTimeExpression&quot;: The exact words about timing (&quot;in two weeks&quot;, &quot;next month&quot;, &quot;this Saturday&quot;)
- &quot;eventDate&quot;: The start/occurrence date as YYYY-MM-DD (when the event begins)
- &quot;eventEndDate&quot;: The expected end date as YYYY-MM-DD if the event has a duration (e.g., end of a trip, last day of a project). For single-day events (birthdays, weddings), set eventEndDate = eventDate. For ongoing/permanent events (preferences, moves), omit eventEndDate.

AGENT NOTE — ALWAYS include an agentNote explaining why this event matters for personalization.
Example: &quot;Customer mentioned daughter's wedding in two weeks — opportunity for gift set plus special occasion makeup recommendations&quot;

OUTPUT:
If a capturable event is detected, return JSON:
{&quot;captured&quot;: true, &quot;eventType&quot;: &quot;...&quot;, &quot;eventDescription&quot;: &quot;...&quot;, &quot;metadataJson&quot;: {...}, &quot;agentNote&quot;: &quot;...&quot;, &quot;eventEndDate&quot;: &quot;YYYY-MM-DD or null&quot;, &quot;captureNotification&quot;: {&quot;type&quot;: &quot;meaningful_event&quot;, &quot;label&quot;: &quot;Event Captured: 2-4 word summary&quot;}}

If no capturable event is detected, return:
{&quot;captured&quot;: false}
        </content>
        <inputs>
            <apiName>ConversationMessage</apiName>
            <definition>primitive://String</definition>
            <masterLabel>Conversation Message</masterLabel>
            <referenceName>Input:ConversationMessage</referenceName>
            <required>true</required>
        </inputs>
        <inputs>
            <apiName>CustomerName</apiName>
            <definition>primitive://String</definition>
            <masterLabel>Customer Name</masterLabel>
            <referenceName>Input:CustomerName</referenceName>
            <required>true</required>
        </inputs>
        <inputs>
            <apiName>AgentType</apiName>
            <definition>primitive://String</definition>
            <masterLabel>Agent Type</masterLabel>
            <referenceName>Input:AgentType</referenceName>
            <required>false</required>
        </inputs>
        <primaryModel>sfdc_ai__DefaultGPT4Omni</primaryModel>
        <status>Published</status>
    </templateVersions>
</GenAiPromptTemplate>
